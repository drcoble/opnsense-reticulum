# Reticulum configuration â€” generated by OPNsense
# Do not edit manually; changes will be overwritten on next Apply.

[reticulum]
  enable_transport = {{ "Yes" if OPNsense.Reticulum.general.enable_transport|default("0") == "1" else "No" }}
  share_instance = {{ "Yes" if OPNsense.Reticulum.general.share_instance|default("1") == "1" else "No" }}
  shared_instance_port = {{ OPNsense.Reticulum.general.shared_instance_port|default("37428") }}
  instance_control_port = {{ OPNsense.Reticulum.general.instance_control_port|default("37429") }}
  panic_on_interface_error = {{ "Yes" if OPNsense.Reticulum.general.panic_on_interface_error|default("0") == "1" else "No" }}
  loglevel = {{ OPNsense.Reticulum.general.loglevel|default("4") }}

[interfaces]
{% if helpers.exists('OPNsense.Reticulum.interfaces') %}
{%   for iface in helpers.toList('OPNsense.Reticulum.interfaces') %}
{%     if iface.enabled == '1' %}

  [[{{ iface.name }}]]
    type = {{ iface.interfaceType }}
    interface_enabled = True
{%       if iface.outgoing is defined and iface.outgoing == '0' %}
    outgoing = false
{%       endif %}
{%       if iface.mode is defined and iface.mode != '' %}
    mode = {{ iface.mode }}
{%       endif %}
{%       if iface.bitrate is defined and iface.bitrate != '' %}
    bitrate = {{ iface.bitrate }}
{%       endif %}
{%       if iface.announce_rate_target is defined and iface.announce_rate_target != '' %}
    announce_rate_target = {{ iface.announce_rate_target }}
{%       endif %}
{%       if iface.announce_rate_grace is defined and iface.announce_rate_grace != '' %}
    announce_rate_grace = {{ iface.announce_rate_grace }}
{%       endif %}
{%       if iface.announce_rate_penalty is defined and iface.announce_rate_penalty != '' %}
    announce_rate_penalty = {{ iface.announce_rate_penalty }}
{%       endif %}
{# ---- AutoInterface ---- #}
{%       if iface.interfaceType == 'AutoInterface' %}
{%         if iface.auto_group_id is defined and iface.auto_group_id != '' %}
    group_id = {{ iface.auto_group_id }}
{%         endif %}
    discovery_scope = {{ iface.auto_discovery_scope|default("link") }}
    discovery_port = {{ iface.auto_discovery_port|default("29716") }}
    data_port = {{ iface.auto_data_port|default("42671") }}
{%         if iface.auto_allowed_interfaces is defined and iface.auto_allowed_interfaces != '' %}
    allowed_interfaces = {{ iface.auto_allowed_interfaces }}
{%         endif %}
{%         if iface.auto_ignored_interfaces is defined and iface.auto_ignored_interfaces != '' %}
    ignored_interfaces = {{ iface.auto_ignored_interfaces }}
{%         endif %}
{# ---- UDPInterface ---- #}
{%       elif iface.interfaceType == 'UDPInterface' %}
    listen_ip = {{ iface.udp_listen_ip|default("0.0.0.0") }}
    listen_port = {{ iface.udp_listen_port|default("4242") }}
{%         if iface.udp_forward_ip is defined and iface.udp_forward_ip != '' %}
    forward_ip = {{ iface.udp_forward_ip }}
    forward_port = {{ iface.udp_forward_port }}
{%         endif %}
{%         if iface.udp_broadcast is defined and iface.udp_broadcast == '1' %}
    broadcast = true
{%         endif %}
{# ---- TCPServerInterface ---- #}
{%       elif iface.interfaceType == 'TCPServerInterface' %}
    listen_ip = {{ iface.tcp_server_listen_ip|default("0.0.0.0") }}
    listen_port = {{ iface.tcp_server_listen_port|default("4242") }}
{%         if iface.tcp_server_i2p_tunneled is defined and iface.tcp_server_i2p_tunneled == '1' %}
    i2p_tunneled = true
{%         endif %}
{# ---- TCPClientInterface ---- #}
{%       elif iface.interfaceType == 'TCPClientInterface' %}
    target_host = {{ iface.tcp_client_target_host }}
    target_port = {{ iface.tcp_client_target_port|default("4242") }}
{%         if iface.tcp_client_kissbytes is defined and iface.tcp_client_kissbytes != '' %}
    kissbytes = {{ iface.tcp_client_kissbytes }}
{%         endif %}
{%         if iface.tcp_client_i2p_tunneled is defined and iface.tcp_client_i2p_tunneled == '1' %}
    i2p_tunneled = true
{%         endif %}
{# ---- RNodeInterface ---- #}
{%       elif iface.interfaceType == 'RNodeInterface' %}
    port = {{ iface.rnode_port|default("/dev/ttyUSB0") }}
    frequency = {{ iface.rnode_frequency|default("868000000") }}
    bandwidth = {{ iface.rnode_bandwidth|default("125000") }}
    txpower = {{ iface.rnode_txpower|default("7") }}
    spreadingfactor = {{ iface.rnode_spreadingfactor|default("7") }}
    codingrate = {{ iface.rnode_codingrate|default("5") }}
{%         if iface.rnode_id is defined and iface.rnode_id != '' %}
    id = {{ iface.rnode_id }}
{%         endif %}
{%         if iface.rnode_flow_control is defined and iface.rnode_flow_control == '1' %}
    flow_control = true
{%         endif %}
{# ---- KISSInterface ---- #}
{%       elif iface.interfaceType == 'KISSInterface' %}
    port = {{ iface.kiss_port }}
    speed = {{ iface.kiss_speed|default("115200") }}
    databits = {{ iface.kiss_databits|default("8") }}
    parity = {{ iface.kiss_parity|default("none") }}
    stopbits = {{ iface.kiss_stopbits|default("1") }}
{%         if iface.kiss_flow_control is defined and iface.kiss_flow_control == '1' %}
    flow_control = true
{%         endif %}
{%         if iface.kiss_preamble is defined and iface.kiss_preamble != '' %}
    preamble = {{ iface.kiss_preamble }}
{%         endif %}
{%         if iface.kiss_txtail is defined and iface.kiss_txtail != '' %}
    txtail = {{ iface.kiss_txtail }}
{%         endif %}
{%         if iface.kiss_persistence is defined and iface.kiss_persistence != '' %}
    persistence = {{ iface.kiss_persistence }}
{%         endif %}
{%         if iface.kiss_slottime is defined and iface.kiss_slottime != '' %}
    slottime = {{ iface.kiss_slottime }}
{%         endif %}
{%         if iface.kiss_beacon_interval is defined and iface.kiss_beacon_interval != '' %}
    beacon_interval = {{ iface.kiss_beacon_interval }}
{%         endif %}
{%         if iface.kiss_beacon_data is defined and iface.kiss_beacon_data != '' %}
    beacon_data = {{ iface.kiss_beacon_data }}
{%         endif %}
{# ---- AX25KISSInterface ---- #}
{%       elif iface.interfaceType == 'AX25KISSInterface' %}
    port = {{ iface.ax25_port }}
    speed = {{ iface.ax25_speed|default("9600") }}
    databits = {{ iface.ax25_databits|default("8") }}
    parity = {{ iface.ax25_parity|default("none") }}
    stopbits = {{ iface.ax25_stopbits|default("1") }}
{%         if iface.ax25_flow_control is defined and iface.ax25_flow_control == '1' %}
    flow_control = true
{%         endif %}
{%         if iface.ax25_callsign is defined and iface.ax25_callsign != '' %}
    callsign = {{ iface.ax25_callsign }}
{%         endif %}
{%         if iface.ax25_ssid is defined and iface.ax25_ssid != '' %}
    ssid = {{ iface.ax25_ssid }}
{%         endif %}
{# ---- SerialInterface ---- #}
{%       elif iface.interfaceType == 'SerialInterface' %}
    port = {{ iface.serial_port }}
    speed = {{ iface.serial_speed|default("9600") }}
    databits = {{ iface.serial_databits|default("8") }}
    parity = {{ iface.serial_parity|default("none") }}
    stopbits = {{ iface.serial_stopbits|default("1") }}
{%         if iface.serial_flow_control is defined and iface.serial_flow_control == '1' %}
    flow_control = true
{%         endif %}
{# ---- I2PInterface ---- #}
{%       elif iface.interfaceType == 'I2PInterface' %}
{%         if iface.i2p_peers is defined and iface.i2p_peers != '' %}
    peers = {{ iface.i2p_peers }}
{%         endif %}
{%       endif %}
{%     endif %}
{%   endfor %}
{% endif %}
